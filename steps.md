## Цель

Описать пошаговую реализацию подхода к структуре тестов и повторному использованию авторизации в текущем проекте на pytest + Playwright.

## Шаги реализации

1. **Выделить сценарий авторизации в отдельный помощник**
   - Создать файл `auth_helper.py` в корне репозитория.
   - Реализовать в нём функцию, которая:
     - поднимает Playwright (sync API);
     - создаёт новый браузерный контекст;
     - использует `AuthPage` из `pages/auth_page.py` для выполнения полного флоу логина;
     - сохраняет `storage_state` в файл `auth_state.json` в корне проекта.
   - Использовать `.env` (`BASE_URL`, `USERNAME`, `PASSWORD` / код) для параметров авторизации.

2. **Изменить фикстуры в `conftest.py` для работы с `auth_state.json`**
   - Добавить фикстуру уровня сессии, которая:
     - проверяет наличие файла `auth_state.json`;
     - при его отсутствии либо:
       - поднимает `auth_helper.py` (если допустимо автогенерировать), либо
       - поднимает осмысленную ошибку с инструкцией запустить `python auth_helper.py`.
   - Добавить фикстуру `authenticated_page`, которая:
     - создаёт новый контекст `browser.new_context(storage_state="auth_state.json")`;
     - возвращает `Page`, уже авторизованную в системе.
   - Сохранить текущую фикстуру `page` для неавторизованных сценариев.

3. **Переписать тесты, зависящие от авторизации**
   - В `tests/test_auth_page.py`:
     - оставить один "эталонный" тест полного флоу логина (с маркером `auth_flow`);
     - остальные тесты, которым нужна только авторизованная сессия, перевести на использование `authenticated_page` и соответствующих POM (например, `InvoicesPage`, `MainPage`).
   - Убедиться, что:
     - основной набор E2E‑тестов не проходит через форму логина каждый раз;
     - полное прохождение авторизации остаётся покрытым как минимум одним тестом.

4. **Ввести базовый класс страниц `BasePage`**
   - Спроектировать единый базовый класс для всех Page Object‑ов, который инкапсулирует общую логику работы со страницей.
   - Вынести в `BasePage`:
     - хранение ссылки на `page: Page` и `base_url` (чтение `BASE_URL` из окружения);
     - единый метод `navigate(relative_path: str = "")`, который открывает `BASE_URL` или `BASE_URL + relative_path` и ждёт загрузки (например, `networkidle`);
     - типовые утилиты: ожидания (`wait_for_network_idle`, обёртки над `wait_for_*`), безопасные клики и ввод текста.
   - Наследовать существующий `AuthPage` и все будущие страницы от `BasePage`, чтобы убрать дублирование и стандартизировать интерфейс POM.
